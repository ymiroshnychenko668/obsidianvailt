# Linux Real-Time Diagnostics Command Reference

This is a consolidated reference of Linux utilities and commands useful for analyzing and tuning jitter, PCIe, IRQs, and CPU affinity for real-time systems like LinuxCNC.

---

## üìò Essential Commands

| Command | Description | Usage / When to Use |
|--------|-------------|---------------------|
| `lspci` | Lists all PCI/PCIe devices | Quick overview of hardware like GPU, LAN, chipset |
| `lspci -tv` | Tree view of PCIe hierarchy | Shows device-to-bridge relationship |
| `lspci -vv` | Detailed PCIe device info | Reveals lane count (`LnkCap`, `LnkSta`), speed |
| `lspci -vv | grep -A15 VGA` | Info about video card | Useful for verifying actual PCIe lane usage |
| `cat /proc/interrupts` | Lists IRQs and CPU counts | See which devices generate the most interrupts |
| `grep nvidia /proc/interrupts` | Filter IRQs from NVIDIA | Diagnose GPU influence on IRQs |
| `cat /proc/irq/<n>/smp_affinity` | Check CPU mask for IRQ | Shows which CPUs handle a given IRQ |
| `echo <val> > /proc/irq/<n>/smp_affinity` | Set affinity for IRQ | Isolate IRQs from LinuxCNC CPUs |
| `dmidecode -t slot` | Info about physical PCIe slots | Helps map PCIe slot capability and layout |
| `latency-histogram` | GUI tool for measuring jitter | Available in LinuxCNC ISOs |
| `latency-histogram --nobase --sbinsize 1000` | Histogram with fine bins | Precise jitter measurement |
| `cyclictest` | CLI jitter measurement tool | Used for objective latency evaluation |
| `setpci` | Read/write PCI config space | Advanced use, e.g. disable MSI |
| `cat /sys/kernel/debug/pci/*/msi_irqs/*` | Show devices using MSI interrupts | Helps trace interrupt mode usage |
| `dmesg` | Kernel boot log | Useful for debugging device init and BIOS |
| `dmesg | grep DMI` | Extracts DMI (firmware) info | Shows motherboard, BIOS version |
| `sudo dmidecode -t system` | System info from BIOS | Shows vendor, product name, serial |
| `sudo dmidecode -s system-product-name` | Output only product name | Scripting-friendly |
| `watch -n 1 cat /proc/interrupts` | Live interrupt monitor | Good for spotting real-time IRQ spikes |

---

## üì¶ Useful Utilities

| Tool | Purpose | Install | Notes |
|------|---------|---------|-------|
| `htop` | Interactive task viewer | `sudo apt install htop` | View per-core usage, IRQ columns |
| `irqtop` | Live IRQ monitor | `sudo apt install irqtop` | See IRQ activity in top-style UI |
| `tuna` | IRQ/CPU tuning tool | `sudo apt install tuna` | Red Hat tool for CPU isolation |
| `taskset` | Launch with set affinity | Built-in | e.g. `taskset -c 2 ./linuxcnc` |
| `stress-ng` | Load generator | `sudo apt install stress-ng` | Test jitter under stress |
| `numactl` | NUMA-aware placement | `sudo apt install numactl` | Advanced systems only |
| `hwloc` / `lstopo` | Visual CPU/PCIe map | `sudo apt install hwloc` | Shows topology and IRQ mapping |
| `powertop` | Power + C-state analysis | `sudo apt install powertop` | Helps identify C-state impact |
| `cpufrequtils` | CPU frequency control | `sudo apt install cpufrequtils` | e.g. set governor to `performance` |
| `msr-tools` | Read/write CPU registers | `sudo apt install msr-tools` | Useful for disabling turbo, etc |
| `perf` | Kernel event profiler | `sudo apt install linux-perf` | Advanced jitter root cause finder |
| `trace-cmd` + `kernelshark` | Kernel tracing | `sudo apt install trace-cmd kernelshark` | GUI/CLI tracing for deep RT analysis |
| `ethtool` | Network adapter control | `sudo apt install ethtool` | View and set NIC coalescing |
| `nvidia-smi` | NVIDIA GPU monitor | Included with driver | View GPU activity and power modes |

---

## üõ†Ô∏è Tuning Tips

- Use `isolcpus=2,3` in GRUB for CPU isolation
- Set CPU governor: `cpufreq-set -g performance`
- Disable C-states, turbo, and ASPM in BIOS
- Use `latency-histogram` and `cyclictest` to benchmark changes

---

Generated by ChatGPT
